<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OMC - Rapports Officiels</title>
    <link rel="stylesheet" href="global.css">
    <link rel="stylesheet" href="rapports.css">
    <link href="https://fonts.googleapis.com/css2?family=Alex+Brush&display=swap" rel="stylesheet">
</head>
<body class="rapports-body">
    <div class="interface-container">
        
        <aside class="sidebar">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-top: -10px; margin-bottom: 25px; gap: 10px;">
                <a href="index.html" class="back-link" style="margin-bottom: 0; white-space: nowrap;">‚Üê RETOUR PORTAIL</a>
                <button onclick="if(window.toggleTheme) window.toggleTheme()" style="background: #1e293b; border: 1px solid #334155; color: white; cursor: pointer; padding: 4px 10px; border-radius: 4px; font-size: 11px; display: flex; align-items: center; gap: 6px; flex-shrink: 0;">
                    <span>üåì</span>
                    <span id="theme-text">Passer mode sombre</span>
                </button>
            </div>

            <h1 class="sidebar-title">RAPPORTS & DOSSIERS</h1>

            <div class="mode-selector">
                <button type="button" id="btn-med" class="mode-btn active" onclick="switchReport('med')">ü©∫ M√âDICAL</button>
                <button type="button" id="btn-psy" class="mode-btn" onclick="switchReport('psy')">üß† PSYCHOLOGIE</button>
                <button type="button" id="btn-auto" class="mode-btn" onclick="switchReport('auto')">üíÄ AUTOPSIE</button>
            </div>

            <div class="form-group" style="background: #0f172a; padding: 10px; border-radius: 6px; border: 1px solid #334155; margin-bottom: 15px;">
                <label style="color: #38bdf8; font-weight: bold; margin-bottom: 10px; display: block;">INFORMATIONS G√âN√âRALES</label>
                
                <label>Sujet du rapport</label>
                <input type="text" id="in-sujet" oninput="up('d-sujet', this.value)" placeholder="..." style="margin-bottom: 10px;">

                <label>Nom & Pr√©nom du Patient / D√©funt</label>
                <input type="text" id="in-nom" oninput="up('d-nom', this.value); genererRef();" placeholder="..." style="margin-bottom: 10px;">
                
                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <label>Date de Naissance</label>
                        <input type="date" id="in-ddn" oninput="upDate('d-ddn', this.value)">
                    </div>
                    <div style="flex: 1;">
                        <label>Sexe</label>
                        <select id="in-sexe" onchange="up('d-sexe', this.options[this.selectedIndex].text)" style="width: 100%; background: #111b2d; color: white; border: 1px solid #334155; padding: 8px; border-radius: 4px; font-size: 11px;">
                            <option value="H">Homme</option>
                            <option value="F">Femme</option>
                            <option value="A">Autre</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Date & Heure de l'intervention</label>
                <div style="display: flex; gap: 5px;">
                    <input type="date" id="in-date-prel" oninput="upDate('d-date', this.value); genererRef();" style="flex: 2;">
                    <input type="time" id="in-heure-prel" oninput="up('d-heure', this.value); genererRef();" style="flex: 1;">
                </div>
            </div>

            <div class="form-group" style="display: flex; gap: 10px;">
                <div style="flex: 1;">
                    <label id="label-doc">Praticien intervenant</label>
                    <input type="text" id="in-doc" placeholder="..." oninput="upDoc();">
                </div>
                <div style="flex: 1;">
                    <label>Grade du praticien</label>
                    <input type="text" id="in-grade" placeholder="..." oninput="upDoc();">
                </div>
            </div>

            <div id="fields-med" class="dynamic-fields">
                <div class="form-group">
                    <label>Circonstances / D√©clarations</label>
                    <textarea id="in-med-circ" rows="3" oninput="upBlock('d-med-circ', 'wrap-med-circ', this.value)" placeholder="Intervention sur..."></textarea>
                </div>
                <div class="form-group">
                    <label>Bilan Clinique & Imagerie</label>
                    <textarea id="in-med-bilan" rows="3" oninput="upBlock('d-med-bilan', 'wrap-med-bilan', this.value)" placeholder="L√©sions constat√©es..."></textarea>
                </div>
                <div class="form-group">
                    <label>Protocole de Soins</label>
                    <textarea id="in-med-soins" rows="2" oninput="upBlock('d-med-soins', 'wrap-med-soins', this.value)" placeholder="Soins apport√©s..."></textarea>
                </div>
                
                <div class="form-group" style="border-top: 1px solid #334155; padding-top: 15px; margin-top: 10px;">
                    <label style="color: #a78bfa; font-weight: bold; margin-bottom: 5px; display: block;">SUIVI & CONCLUSION</label>
                    <textarea id="in-med-conclusion" rows="2" oninput="upMedSuivi()" placeholder="Pronostic favorable..." style="margin-bottom: 10px;"></textarea>
                    <div style="display: flex; gap: 10px;">
                        <div class="form-group" style="flex: 2; margin-bottom: 0;">
                            <label>Temps de r√©cup√©ration</label>
                            <input type="text" id="in-med-repos" oninput="upMedSuivi()" placeholder="...">
                        </div>
                        <div class="form-group" style="flex: 1; margin-bottom: 0;">
                            <label>Facturation ($)</label>
                            <input type="text" id="in-med-prix" oninput="upMedSuivi()" placeholder="...">
                        </div>
                    </div>
                </div>
            </div>

            <div id="fields-psy" class="dynamic-fields" style="display: none;">
                <div class="form-group">
                    <label>Contexte / Motif</label>
                    <textarea id="in-psy-circ" rows="2" oninput="upBlock('d-psy-circ', 'wrap-psy-circ', this.value)" placeholder="..."></textarea>
                </div>
                <div class="form-group">
                    <label>Observations Cliniques</label>
                    <textarea id="in-psy-obs" rows="3" oninput="upBlock('d-psy-obs', 'wrap-psy-obs', this.value)" placeholder="..."></textarea>
                </div>
                <div class="form-group">
                    <label>Analyse & Diagnostic</label>
                    <textarea id="in-psy-diag" rows="3" oninput="upBlock('d-psy-diag', 'wrap-psy-diag', this.value)" placeholder="..."></textarea>
                </div>
                <div class="form-group">
                    <label>Conclusion & Recommandations</label>
                    <textarea id="in-psy-reco" rows="2" oninput="upBlock('d-psy-reco', 'wrap-psy-reco', this.value)" placeholder="..."></textarea>
                </div>
            </div>

            <div id="fields-auto" class="dynamic-fields" style="display: none;">
                <div class="form-group">
                    <label>Heure estim√©e du d√©c√®s</label>
                    <input type="time" id="in-auto-heure" oninput="upBlock('d-auto-heure', 'd-info-auto', this.value)">
                </div>
                <div class="form-group">
                    <label>Examen Externe</label>
                    <textarea id="in-auto-ext" rows="3" oninput="upBlock('d-auto-ext', 'wrap-auto-ext', this.value)" placeholder="..."></textarea>
                </div>
                <div class="form-group">
                    <label>Examen Interne</label>
                    <textarea id="in-auto-int" rows="3" oninput="upBlock('d-auto-int', 'wrap-auto-int', this.value)" placeholder="..."></textarea>
                </div>
                <div class="form-group">
                    <label>Conclusion M√©dico-l√©gale</label>
                    <textarea id="in-auto-cause" rows="2" oninput="upBlock('d-auto-cause', 'wrap-auto-cause', this.value)" placeholder="..."></textarea>
                </div>
            </div>

            <div style="margin-top: 20px; border-top: 2px solid #334155; padding-top: 15px;">
                <button type="button" onclick="ajouterSectionCustom()" style="background: transparent; color: #f472b6; border: 1px dashed #f472b6; padding: 10px; width: 100%; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 11px; transition: 0.2s;">
                    ‚ûï AJOUTER UNE SECTION SUPPL√âMENTAIRE
                </button>
                <div id="custom-inputs-container" style="margin-top: 15px;"></div>
            </div>

            <div class="form-group" style="margin-top: 25px; border-top: 2px solid #334155; padding-top: 15px;">
                <label style="color: #cbd5e1; font-weight: bold;">Signataire (Bas de page)</label>
                <input type="text" id="in-sig" placeholder="..." oninput="upSig(this.value);">
            </div>

            <div class="actions-group" style="margin-top: 20px; display: flex; flex-direction: column; gap: 10px;">
                <button type="button" onclick="genererImageRapport()" class="btn-image">üñºÔ∏è G√âN√âRER L'IMAGE</button>
                <button id="discord-btn" type="button" onclick="envoyerRapportDiscord()" class="btn-discord">üì® ENVOYER SUR L'INTRANET</button>
            </div>
        </aside>

        <main class="preview-area" style="align-items: flex-start;">
            <div id="document">
                <div class="header-lab" style="display: flex; align-items: center; gap: 20px; border-bottom: 2px solid #0a192f; padding-bottom: 20px; margin-bottom: 25px;">
                    <img src="assets/logo_omc.png" alt="Logo OMC" style="height: 60px; object-fit: contain;">
                    <div style="flex-grow: 1;">
                        <div style="background: #0a192f; color: white; display: inline-block; padding: 2px 10px; border-radius: 4px; font-weight: 800; font-size: 11px; letter-spacing: 1px; margin-bottom: 5px;">
                            OCEAN MEDICAL CENTER
                        </div>
                        <h1 id="d-titre-doc" style="margin: 0; font-size: 24px; font-weight: 900; color: #0a192f; text-transform: uppercase; letter-spacing: -1px;">
                            DOSSIER M√âDICAL
                        </h1>
                    </div>
                    <div style="text-align: right; font-size: 10px; color: #94a3b8; font-weight: bold;">
                        R√âF : <span id="d-ref">#...</span><br>
                        <span id="d-date">...</span> - <span id="d-heure">--:--</span>
                    </div>
                </div>

                <div class="patient-card" style="grid-template-columns: 1fr;">
                    <div style="display: flex; justify-content: space-between;">
                        <div>
                            Sujet : <strong id="d-sujet" style="font-size: 18px;">...</strong><br>
                            Nom/Pr√©nom : <strong id="d-nom">...</strong><br>
                            Date de Naissance : <span id="d-ddn">...</span><br>
                            Sexe : <span id="d-sexe">Homme</span>
                        </div>
                        <div id="d-info-auto" style="text-align: right; display: none;">
                            <strong style="color: #b91c1c;">Heure du d√©c√®s estim√©e :</strong><br>
                            <span id="d-auto-heure"></span>
                        </div>
                    </div>
                </div>

                <div id="wrap-doc" style="margin-top: 25px; display: none;">
                    <strong style="font-size: 14px; color: #0a1324;">PRATICIEN EN CHARGE :</strong> <span id="d-doc"></span>
                </div>

                <div id="render-med" class="render-section">
                    <div id="wrap-med-circ" style="display: none;">
                        <h4 class="doc-h4">CIRCONSTANCES DE L'INTERVENTION</h4>
                        <p id="d-med-circ" class="doc-p"></p>
                    </div>
                    
                    <div id="wrap-med-bilan" style="display: none;">
                        <h4 class="doc-h4">BILAN CLINIQUE ET IMAGERIE</h4>
                        <p id="d-med-bilan" class="doc-p"></p>
                    </div>
                    
                    <div id="wrap-med-soins" style="display: none;">
                        <h4 class="doc-h4">PROTOCOLE DE SOINS APPLIQU√â</h4>
                        <p id="d-med-soins" class="doc-p"></p>
                    </div>

                    <div id="wrap-med-suivi" style="display: none;">
                        <h4 class="doc-h4">SUIVI & CONCLUSION</h4>
                        <p id="d-med-conclusion" class="doc-p" style="display: none;"></p>
                        
                        <div style="margin-top: 10px;">
                            <p class="doc-p" id="wrap-med-repos" style="display: none; margin: 2px 0;"><strong>Temps de r√©cup√©ration :</strong> <span id="d-med-repos"></span></p>
                            <p class="doc-p" id="wrap-med-prix" style="display: none; margin: 2px 0;"><strong>Facturation :</strong> <span id="d-med-prix"></span> $</p>
                        </div>
                    </div>
                </div>

                <div id="render-psy" class="render-section" style="display: none;">
                    <div id="wrap-psy-circ" style="display: none;">
                        <h4 class="doc-h4">CONTEXTE & MOTIF</h4>
                        <p id="d-psy-circ" class="doc-p"></p>
                    </div>
                    
                    <div id="wrap-psy-obs" style="display: none;">
                        <h4 class="doc-h4">OBSERVATIONS CLINIQUES</h4>
                        <p id="d-psy-obs" class="doc-p"></p>
                    </div>
                    
                    <div id="wrap-psy-diag" style="display: none;">
                        <h4 class="doc-h4">ANALYSE & DIAGNOSTIC</h4>
                        <p id="d-psy-diag" class="doc-p"></p>
                    </div>

                    <div id="wrap-psy-reco" style="display: none;">
                        <h4 class="doc-h4">CONCLUSION & RECOMMANDATIONS</h4>
                        <p id="d-psy-reco" class="doc-p"></p>
                    </div>
                </div>

                <div id="render-auto" class="render-section" style="display: none;">
                    <div id="wrap-auto-ext" style="display: none;">
                        <h4 class="doc-h4">EXAMEN EXTERNE</h4>
                        <p id="d-auto-ext" class="doc-p"></p>
                    </div>
                    
                    <div id="wrap-auto-int" style="display: none;">
                        <h4 class="doc-h4">EXAMEN INTERNE</h4>
                        <p id="d-auto-int" class="doc-p"></p>
                    </div>
                    
                    <div id="wrap-auto-cause" style="display: none;">
                        <h4 class="doc-h4">CONCLUSION M√âDICO-L√âGALE</h4>
                        <p id="d-auto-cause" class="doc-p" style="font-weight: bold;"></p>
                    </div>
                </div>

                <div id="render-custom"></div>

                <div class="cert-footer" style="margin-top: 40px; display: flex; justify-content: space-between; align-items: flex-end; padding-bottom: 5px;">
                    <div class="cert-signature" style="text-align: left;">
                        <span style="font-size: 12px; font-weight: bold;">√âtabli par :</span><br><br>
                        <span id="d-sig" class="signature-line" style="display: none;"></span>
                    </div>

                    <div class="qr-container" style="text-align: center;">
                        <img id="qr-ref" src="" alt="QR" style="width: 85px; height: 85px; border: 1px solid #0a192f; border-radius: 8px; padding: 2px; background: white;">
                        <div style="font-size: 10px; font-weight: 900; color: #0a192f; margin-top: 5px; text-transform: uppercase;">OFFICIAL RECORD</div>
                    </div>
                </div>

                <p class="legal-text" style="margin-top: 20px; font-size: 10px; color: #000; border-top: 1px solid #eee; padding-top: 10px; font-style: italic; margin-bottom: 0;">
                    Ce document est un acte officiel de l'Ocean Medical Center. Destin√© aux autorit√©s comp√©tentes (DOJ/LSPD/BCSO). Toute falsification est passible de poursuites p√©nales.
                </p>
            </div> 
        </main>
    </div>

    <div id="image-popup" class="popup-overlay" style="display:none;">
        <div class="popup-content">
            <h3>Rapport Officiel G√©n√©r√©</h3>
            <input type="text" id="direct-link" readonly onclick="this.select()">
            <div class="popup-buttons">
                <button onclick="copyLink()" class="btn-copy">Copier le lien</button>
                <button onclick="closePopup()" class="btn-close">Fermer</button>
            </div>
            <img id="preview-img-result" src="">
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script type="module" src="global.js"></script>
    <script src="rapports.js"></script>
</body>
</html>
